<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Handy first, the QR Identification">
		<meta name="author" content="Robert Böszörmenyi">
		<title>
			{% block title %}Zero Intrusion Lock & Layered Encryption – Secure QR Authentication
			{% endblock %}
		</title>
		{% block stylesheets %}
			<link rel="stylesheet" href="{{ asset('styles/style.css') }}?v=123">
		{% endblock %}
			{{ encore_entry_link_tags('app') }}
			{{ encore_entry_script_tags('app') }}
	</head>
	<body>
		<div class="container-fluid">
			{% block container %}
				{{ include('partials/header.html.twig', { oneTouchActivation: oneTouchActivation is defined ? oneTouchActivation : false }) }}
				<div id="content">
					{% block content %}
						<div class="btn-group" role="group" aria-label="Basic example">
							{% block buttons %}
								<div class="menu">
									<nav>
										<ul>
											
												<li><a href="/">Home</a></li>
												{% if menuItem_instanceRegistration %}
													<li>
														<a href="/instance">Instance</a>
														<ul>
															<li><a href="/instance-registration">Instance Registration</a></li>
															<li><a href="/instance-registration-follow-up">Instance Registration Confirmation</a></li>													
														</ul>
													</li>
												{% endif %} 
												<li>
													{% if is_jwt_valid %}
														<a href="/business">Business</a>
													{% else %}
														<a id="businessBtn" href="/business">Business</a>			
													{% endif %}																			
												</li>		
												
												<li>
													{% if is_jwt_valid %}
														<a href="/account">Account</a>
													{% else %}
														<a id="accountBtn" href="/account">Account</a>									
													{% endif %}
												</li>																								
										</ul>
									</nav>								
							{% endblock %}
						</div>
						<main>
							{% block body %}{% endblock %}
						</main>
					{% endblock %}
				</div>
			{% endblock %}
		</div>
		{% block javascript %}{% endblock %}
	</body>

	<script>
		// Hide One Touch Activation button if loggedInUserName and loggedInUserPublicId are present in the localStorage - OneTouchUsers
		 loggedInUserEmail = "{{ is_jwt_valid ? is_jwt_valid.username : '' }}";
		 loggedInUserPublicId = "{{ is_jwt_valid ? is_jwt_valid.publicId : '' }}";
		 oneTouchUsers = JSON.parse(localStorage.getItem("oneTouchUsers") || "[]");

		oneTouchUsers.forEach(user => {
			if(user.email === loggedInUserEmail && user.userPublicId === loggedInUserPublicId){
				document.getElementById("oneTouchUserBtn").style.display = "none";
			}
		});


		// Click on loginBtn || businessBtn => From get to post if oneTouchUsers are present in the localStorage
		document.addEventListener('click', function(e) {
			var loginBtn = document.getElementById("accountBtn");
			var businessBtn = document.getElementById("businessBtn");

				if ( (loginBtn && loginBtn.contains(e.target)) || (businessBtn && businessBtn.contains(e.target)) ) {	
						
				const oneTouchUsers = localStorage.getItem('oneTouchUsers');
				if (oneTouchUsers) {
					const form = document.createElement('form');
					form.method = 'POST';
					form.action = '/user-login';

					const input = document.createElement('input');
					input.type = 'hidden';
					input.name = 'oneTouchUsers';
					input.value = oneTouchUsers;

					form.appendChild(input);
					document.body.appendChild(form);
					form.submit();
				} else {
					window.location.href = '/user-login';
				}
			}
		});

	</script>
</html>
